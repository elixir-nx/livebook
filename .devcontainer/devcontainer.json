// For format details, see https://aka.ms/devcontainer.json.
// Also see https://github.com/microsoft/vscode-dev-containers/tree/v0.231.6/containers/elixir-phoenix-postgres
{
  "name": "Livebook development environment",
  "dockerComposeFile": "docker-compose.yml",
  "service": "livebook_dev",

  // Despite being required to set workspaceFolder, it doesn't actually do anything and you end up in /workspaces/livebook no matter what.
  "workspaceFolder": "/workspaces/livebook",

  // Codespaces will mount the source code and overwrite the build artifacts that the Dockerfile creates, so we rebuild with a lifecycle script.
  "updateContentCommand": "mix do dev.setup, deps.compile, compile",

  "extensions": ["jakebecker.elixir-ls"],
  "forwardPorts": [4000, 4001, 8080, 8081],
  "otherPortsAttributes": {
    "onAutoForward": "ignore"
  },
  "settings": {
    // Needed because of: https://github.com/microsoft/vscode/issues/102057#issuecomment-657728467
    "debug.javascript.autoAttachFilter": "onlyWithFlag",
    "debug.javascript.autoAttachSmartPattern": [
      "!**/node_modules/**",
      "**/$KNOWN_TOOLS$/**"
    ]
  },
}
